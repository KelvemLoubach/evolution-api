{"version":3,"sources":["../../../../../../src/api/integrations/chatbot/openai/services/openai.service.ts","../../../../../../src/api/types/wa.types.ts","../../../../../../src/config/logger.config.ts","../../../../../../src/config/env.config.ts","../../../../../../src/utils/sendTelemetry.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport { InstanceDto } from '@api/dto/instance.dto';\r\nimport { PrismaRepository } from '@api/repository/repository.service';\r\nimport { WAMonitoringService } from '@api/services/monitor.service';\r\nimport { Integration } from '@api/types/wa.types';\r\nimport { ConfigService, Language } from '@config/env.config';\r\nimport { Logger } from '@config/logger.config';\r\nimport { IntegrationSession, OpenaiBot, OpenaiCreds, OpenaiSetting } from '@prisma/client';\r\nimport { sendTelemetry } from '@utils/sendTelemetry';\r\nimport axios from 'axios';\r\nimport { downloadMediaMessage } from 'baileys';\r\nimport FormData from 'form-data';\r\nimport OpenAI from 'openai';\r\nimport P from 'pino';\r\n\r\nexport class OpenaiService {\r\n  constructor(\r\n    private readonly waMonitor: WAMonitoringService,\r\n    private readonly configService: ConfigService,\r\n    private readonly prismaRepository: PrismaRepository,\r\n  ) {}\r\n\r\n  private client: OpenAI;\r\n\r\n  private readonly logger = new Logger('OpenaiService');\r\n\r\n  private async sendMessageToBot(instance: any, openaiBot: OpenaiBot, remoteJid: string, content: string) {\r\n    const systemMessages: any = openaiBot.systemMessages;\r\n\r\n    const messagesSystem: any[] = systemMessages.map((message) => {\r\n      return {\r\n        role: 'system',\r\n        content: message,\r\n      };\r\n    });\r\n\r\n    const assistantMessages: any = openaiBot.assistantMessages;\r\n\r\n    const messagesAssistant: any[] = assistantMessages.map((message) => {\r\n      return {\r\n        role: 'assistant',\r\n        content: message,\r\n      };\r\n    });\r\n\r\n    const userMessages: any = openaiBot.userMessages;\r\n\r\n    const messagesUser: any[] = userMessages.map((message) => {\r\n      return {\r\n        role: 'user',\r\n        content: message,\r\n      };\r\n    });\r\n\r\n    const messageData: any = {\r\n      role: 'user',\r\n      content: [{ type: 'text', text: content }],\r\n    };\r\n\r\n    if (this.isImageMessage(content)) {\r\n      const contentSplit = content.split('|');\r\n\r\n      const url = contentSplit[1].split('?')[0];\r\n\r\n      messageData.content = [\r\n        { type: 'text', text: contentSplit[2] || content },\r\n        {\r\n          type: 'image_url',\r\n          image_url: {\r\n            url: url,\r\n          },\r\n        },\r\n      ];\r\n    }\r\n\r\n    const messages: any[] = [...messagesSystem, ...messagesAssistant, ...messagesUser, messageData];\r\n\r\n    if (instance.integration === Integration.WHATSAPP_BAILEYS) {\r\n      await instance.client.presenceSubscribe(remoteJid);\r\n      await instance.client.sendPresenceUpdate('composing', remoteJid);\r\n    }\r\n\r\n    const completions = await this.client.chat.completions.create({\r\n      model: openaiBot.model,\r\n      messages: messages,\r\n      max_tokens: openaiBot.maxTokens,\r\n    });\r\n\r\n    if (instance.integration === Integration.WHATSAPP_BAILEYS)\r\n      await instance.client.sendPresenceUpdate('paused', remoteJid);\r\n\r\n    const message = completions.choices[0].message.content;\r\n\r\n    return message;\r\n  }\r\n\r\n  private async sendMessageToAssistant(\r\n    instance: any,\r\n    openaiBot: OpenaiBot,\r\n    remoteJid: string,\r\n    pushName: string,\r\n    fromMe: boolean,\r\n    content: string,\r\n    threadId: string,\r\n  ) {\r\n    const messageData: any = {\r\n      role: fromMe ? 'assistant' : 'user',\r\n      content: [{ type: 'text', text: content }],\r\n    };\r\n\r\n    if (this.isImageMessage(content)) {\r\n      const contentSplit = content.split('|');\r\n\r\n      const url = contentSplit[1].split('?')[0];\r\n\r\n      messageData.content = [\r\n        { type: 'text', text: contentSplit[2] || content },\r\n        {\r\n          type: 'image_url',\r\n          image_url: {\r\n            url: url,\r\n          },\r\n        },\r\n      ];\r\n    }\r\n\r\n    await this.client.beta.threads.messages.create(threadId, messageData);\r\n\r\n    if (fromMe) {\r\n      sendTelemetry('/message/sendText');\r\n      return;\r\n    }\r\n\r\n    const runAssistant = await this.client.beta.threads.runs.create(threadId, {\r\n      assistant_id: openaiBot.assistantId,\r\n    });\r\n\r\n    if (instance.integration === Integration.WHATSAPP_BAILEYS) {\r\n      await instance.client.presenceSubscribe(remoteJid);\r\n      await instance.client.sendPresenceUpdate('composing', remoteJid);\r\n    }\r\n\r\n    const response = await this.getAIResponse(threadId, runAssistant.id, openaiBot.functionUrl, remoteJid, pushName);\r\n\r\n    if (instance.integration === Integration.WHATSAPP_BAILEYS)\r\n      await instance.client.sendPresenceUpdate('paused', remoteJid);\r\n\r\n    const message = response?.data[0].content[0].text.value;\r\n\r\n    return message;\r\n  }\r\n\r\n  private async sendMessageWhatsapp(\r\n    instance: any,\r\n    session: IntegrationSession,\r\n    remoteJid: string,\r\n    settings: OpenaiSetting,\r\n    message: string,\r\n  ) {\r\n    const linkRegex = /(!?)\\[(.*?)\\]\\((.*?)\\)/g;\r\n\r\n    let textBuffer = '';\r\n    let lastIndex = 0;\r\n\r\n    let match: RegExpExecArray | null;\r\n\r\n    const getMediaType = (url: string): string | null => {\r\n      const extension = url.split('.').pop()?.toLowerCase();\r\n      const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'bmp', 'webp'];\r\n      const audioExtensions = ['mp3', 'wav', 'aac', 'ogg'];\r\n      const videoExtensions = ['mp4', 'avi', 'mkv', 'mov'];\r\n      const documentExtensions = ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'txt'];\r\n\r\n      if (imageExtensions.includes(extension || '')) return 'image';\r\n      if (audioExtensions.includes(extension || '')) return 'audio';\r\n      if (videoExtensions.includes(extension || '')) return 'video';\r\n      if (documentExtensions.includes(extension || '')) return 'document';\r\n      return null;\r\n    };\r\n\r\n    while ((match = linkRegex.exec(message)) !== null) {\r\n      const [fullMatch, exclMark, altText, url] = match;\r\n      const mediaType = getMediaType(url);\r\n\r\n      const beforeText = message.slice(lastIndex, match.index);\r\n      if (beforeText) {\r\n        textBuffer += beforeText;\r\n      }\r\n\r\n      if (mediaType) {\r\n        const splitMessages = settings.splitMessages ?? false;\r\n        const timePerChar = settings.timePerChar ?? 0;\r\n        const minDelay = 1000;\r\n        const maxDelay = 20000;\r\n\r\n        if (textBuffer.trim()) {\r\n          if (splitMessages) {\r\n            const multipleMessages = textBuffer.trim().split('\\n\\n');\r\n\r\n            for (let index = 0; index < multipleMessages.length; index++) {\r\n              const message = multipleMessages[index];\r\n\r\n              const delay = Math.min(Math.max(message.length * timePerChar, minDelay), maxDelay);\r\n\r\n              if (instance.integration === Integration.WHATSAPP_BAILEYS) {\r\n                await instance.client.presenceSubscribe(remoteJid);\r\n                await instance.client.sendPresenceUpdate('composing', remoteJid);\r\n              }\r\n\r\n              await new Promise<void>((resolve) => {\r\n                setTimeout(async () => {\r\n                  await instance.textMessage(\r\n                    {\r\n                      number: remoteJid.split('@')[0],\r\n                      delay: settings?.delayMessage || 1000,\r\n                      text: message,\r\n                    },\r\n                    false,\r\n                  );\r\n                  resolve();\r\n                }, delay);\r\n              });\r\n\r\n              if (instance.integration === Integration.WHATSAPP_BAILEYS) {\r\n                await instance.client.sendPresenceUpdate('paused', remoteJid);\r\n              }\r\n            }\r\n          } else {\r\n            await instance.textMessage(\r\n              {\r\n                number: remoteJid.split('@')[0],\r\n                delay: settings?.delayMessage || 1000,\r\n                text: textBuffer.trim(),\r\n              },\r\n              false,\r\n            );\r\n          }\r\n          textBuffer = '';\r\n        }\r\n\r\n        if (mediaType === 'audio') {\r\n          await instance.audioWhatsapp({\r\n            number: remoteJid.split('@')[0],\r\n            delay: settings?.delayMessage || 1000,\r\n            audio: url,\r\n            caption: altText,\r\n          });\r\n        } else {\r\n          await instance.mediaMessage(\r\n            {\r\n              number: remoteJid.split('@')[0],\r\n              delay: settings?.delayMessage || 1000,\r\n              mediatype: mediaType,\r\n              media: url,\r\n              caption: altText,\r\n            },\r\n            null,\r\n            false,\r\n          );\r\n        }\r\n      } else {\r\n        textBuffer += `[${altText}](${url})`;\r\n      }\r\n\r\n      lastIndex = linkRegex.lastIndex;\r\n    }\r\n\r\n    if (lastIndex < message.length) {\r\n      const remainingText = message.slice(lastIndex);\r\n      if (remainingText.trim()) {\r\n        textBuffer += remainingText;\r\n      }\r\n    }\r\n\r\n    const splitMessages = settings.splitMessages ?? false;\r\n    const timePerChar = settings.timePerChar ?? 0;\r\n    const minDelay = 1000;\r\n    const maxDelay = 20000;\r\n\r\n    if (textBuffer.trim()) {\r\n      if (splitMessages) {\r\n        const multipleMessages = textBuffer.trim().split('\\n\\n');\r\n\r\n        for (let index = 0; index < multipleMessages.length; index++) {\r\n          const message = multipleMessages[index];\r\n\r\n          const delay = Math.min(Math.max(message.length * timePerChar, minDelay), maxDelay);\r\n\r\n          if (instance.integration === Integration.WHATSAPP_BAILEYS) {\r\n            await instance.client.presenceSubscribe(remoteJid);\r\n            await instance.client.sendPresenceUpdate('composing', remoteJid);\r\n          }\r\n\r\n          await new Promise<void>((resolve) => {\r\n            setTimeout(async () => {\r\n              await instance.textMessage(\r\n                {\r\n                  number: remoteJid.split('@')[0],\r\n                  delay: settings?.delayMessage || 1000,\r\n                  text: message,\r\n                },\r\n                false,\r\n              );\r\n              resolve();\r\n            }, delay);\r\n          });\r\n\r\n          if (instance.integration === Integration.WHATSAPP_BAILEYS) {\r\n            await instance.client.sendPresenceUpdate('paused', remoteJid);\r\n          }\r\n        }\r\n      } else {\r\n        await instance.textMessage(\r\n          {\r\n            number: remoteJid.split('@')[0],\r\n            delay: settings?.delayMessage || 1000,\r\n            text: textBuffer.trim(),\r\n          },\r\n          false,\r\n        );\r\n      }\r\n      textBuffer = '';\r\n    }\r\n\r\n    sendTelemetry('/message/sendText');\r\n\r\n    await this.prismaRepository.integrationSession.update({\r\n      where: {\r\n        id: session.id,\r\n      },\r\n      data: {\r\n        status: 'opened',\r\n        awaitUser: true,\r\n      },\r\n    });\r\n  }\r\n\r\n  public async createAssistantNewSession(instance: InstanceDto, data: any) {\r\n    if (data.remoteJid === 'status@broadcast') return;\r\n\r\n    const creds = await this.prismaRepository.openaiCreds.findFirst({\r\n      where: {\r\n        id: data.openaiCredsId,\r\n      },\r\n    });\r\n\r\n    if (!creds) throw new Error('Openai Creds not found');\r\n\r\n    try {\r\n      this.client = new OpenAI({\r\n        apiKey: creds.apiKey,\r\n      });\r\n\r\n      const threadId = (await this.client.beta.threads.create({})).id;\r\n\r\n      let session = null;\r\n      if (threadId) {\r\n        session = await this.prismaRepository.integrationSession.create({\r\n          data: {\r\n            remoteJid: data.remoteJid,\r\n            pushName: data.pushName,\r\n            sessionId: threadId,\r\n            status: 'opened',\r\n            awaitUser: false,\r\n            botId: data.botId,\r\n            instanceId: instance.instanceId,\r\n            type: 'openai',\r\n          },\r\n        });\r\n      }\r\n      return { session };\r\n    } catch (error) {\r\n      this.logger.error(error);\r\n      return;\r\n    }\r\n  }\r\n\r\n  private async initAssistantNewSession(\r\n    instance: any,\r\n    remoteJid: string,\r\n    pushName: string,\r\n    fromMe: boolean,\r\n    openaiBot: OpenaiBot,\r\n    settings: OpenaiSetting,\r\n    session: IntegrationSession,\r\n    content: string,\r\n  ) {\r\n    const data = await this.createAssistantNewSession(instance, {\r\n      remoteJid,\r\n      pushName,\r\n      openaiCredsId: openaiBot.openaiCredsId,\r\n      botId: openaiBot.id,\r\n    });\r\n\r\n    if (data.session) {\r\n      session = data.session;\r\n    }\r\n\r\n    const message = await this.sendMessageToAssistant(\r\n      instance,\r\n      openaiBot,\r\n      remoteJid,\r\n      pushName,\r\n      fromMe,\r\n      content,\r\n      session.sessionId,\r\n    );\r\n\r\n    await this.sendMessageWhatsapp(instance, session, remoteJid, settings, message);\r\n\r\n    return;\r\n  }\r\n\r\n  private isJSON(str: string): boolean {\r\n    try {\r\n      JSON.parse(str);\r\n      return true;\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private async getAIResponse(\r\n    threadId: string,\r\n    runId: string,\r\n    functionUrl: string,\r\n    remoteJid: string,\r\n    pushName: string,\r\n  ) {\r\n    const getRun = await this.client.beta.threads.runs.retrieve(threadId, runId);\r\n    let toolCalls;\r\n    switch (getRun.status) {\r\n      case 'requires_action':\r\n        toolCalls = getRun?.required_action?.submit_tool_outputs?.tool_calls;\r\n\r\n        if (toolCalls) {\r\n          for (const toolCall of toolCalls) {\r\n            const id = toolCall.id;\r\n            const functionName = toolCall?.function?.name;\r\n            const functionArgument = this.isJSON(toolCall?.function?.arguments)\r\n              ? JSON.parse(toolCall?.function?.arguments)\r\n              : toolCall?.function?.arguments;\r\n\r\n            let output = null;\r\n\r\n            try {\r\n              const { data } = await axios.post(functionUrl, {\r\n                name: functionName,\r\n                arguments: { ...functionArgument, remoteJid, pushName },\r\n              });\r\n\r\n              output = JSON.stringify(data)\r\n                .replace(/\\\\/g, '\\\\\\\\')\r\n                .replace(/\"/g, '\\\\\"')\r\n                .replace(/\\n/g, '\\\\n')\r\n                .replace(/\\r/g, '\\\\r')\r\n                .replace(/\\t/g, '\\\\t');\r\n            } catch (error) {\r\n              output = JSON.stringify(error)\r\n                .replace(/\\\\/g, '\\\\\\\\')\r\n                .replace(/\"/g, '\\\\\"')\r\n                .replace(/\\n/g, '\\\\n')\r\n                .replace(/\\r/g, '\\\\r')\r\n                .replace(/\\t/g, '\\\\t');\r\n            }\r\n\r\n            await this.client.beta.threads.runs.submitToolOutputs(threadId, runId, {\r\n              tool_outputs: [\r\n                {\r\n                  tool_call_id: id,\r\n                  output,\r\n                },\r\n              ],\r\n            });\r\n          }\r\n        }\r\n\r\n        return this.getAIResponse(threadId, runId, functionUrl, remoteJid, pushName);\r\n      case 'queued':\r\n        await new Promise((resolve) => setTimeout(resolve, 1000));\r\n        return this.getAIResponse(threadId, runId, functionUrl, remoteJid, pushName);\r\n      case 'in_progress':\r\n        await new Promise((resolve) => setTimeout(resolve, 1000));\r\n        return this.getAIResponse(threadId, runId, functionUrl, remoteJid, pushName);\r\n      case 'completed':\r\n        return await this.client.beta.threads.messages.list(threadId, {\r\n          run_id: runId,\r\n          limit: 1,\r\n        });\r\n    }\r\n  }\r\n\r\n  private isImageMessage(content: string) {\r\n    return content.includes('imageMessage');\r\n  }\r\n\r\n  public async processOpenaiAssistant(\r\n    instance: any,\r\n    remoteJid: string,\r\n    pushName: string,\r\n    fromMe: boolean,\r\n    openaiBot: OpenaiBot,\r\n    session: IntegrationSession,\r\n    settings: OpenaiSetting,\r\n    content: string,\r\n  ) {\r\n    if (session && session.status === 'closed') {\r\n      return;\r\n    }\r\n\r\n    if (session && settings.expire && settings.expire > 0) {\r\n      const now = Date.now();\r\n\r\n      const sessionUpdatedAt = new Date(session.updatedAt).getTime();\r\n\r\n      const diff = now - sessionUpdatedAt;\r\n\r\n      const diffInMinutes = Math.floor(diff / 1000 / 60);\r\n\r\n      if (diffInMinutes > settings.expire) {\r\n        if (settings.keepOpen) {\r\n          await this.prismaRepository.integrationSession.update({\r\n            where: {\r\n              id: session.id,\r\n            },\r\n            data: {\r\n              status: 'closed',\r\n            },\r\n          });\r\n        } else {\r\n          await this.prismaRepository.integrationSession.deleteMany({\r\n            where: {\r\n              botId: openaiBot.id,\r\n              remoteJid: remoteJid,\r\n            },\r\n          });\r\n        }\r\n\r\n        await this.initAssistantNewSession(\r\n          instance,\r\n          remoteJid,\r\n          pushName,\r\n          fromMe,\r\n          openaiBot,\r\n          settings,\r\n          session,\r\n          content,\r\n        );\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (!session) {\r\n      await this.initAssistantNewSession(instance, remoteJid, pushName, fromMe, openaiBot, settings, session, content);\r\n      return;\r\n    }\r\n\r\n    if (session.status !== 'paused')\r\n      await this.prismaRepository.integrationSession.update({\r\n        where: {\r\n          id: session.id,\r\n        },\r\n        data: {\r\n          status: 'opened',\r\n          awaitUser: false,\r\n        },\r\n      });\r\n\r\n    if (!content) {\r\n      if (settings.unknownMessage) {\r\n        this.waMonitor.waInstances[instance.instanceName].textMessage(\r\n          {\r\n            number: remoteJid.split('@')[0],\r\n            delay: settings.delayMessage || 1000,\r\n            text: settings.unknownMessage,\r\n          },\r\n          false,\r\n        );\r\n\r\n        sendTelemetry('/message/sendText');\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (settings.keywordFinish && content.toLowerCase() === settings.keywordFinish.toLowerCase()) {\r\n      if (settings.keepOpen) {\r\n        await this.prismaRepository.integrationSession.update({\r\n          where: {\r\n            id: session.id,\r\n          },\r\n          data: {\r\n            status: 'closed',\r\n          },\r\n        });\r\n      } else {\r\n        await this.prismaRepository.integrationSession.deleteMany({\r\n          where: {\r\n            botId: openaiBot.id,\r\n            remoteJid: remoteJid,\r\n          },\r\n        });\r\n      }\r\n      return;\r\n    }\r\n\r\n    const creds = await this.prismaRepository.openaiCreds.findFirst({\r\n      where: {\r\n        id: openaiBot.openaiCredsId,\r\n      },\r\n    });\r\n\r\n    if (!creds) throw new Error('Openai Creds not found');\r\n\r\n    this.client = new OpenAI({\r\n      apiKey: creds.apiKey,\r\n    });\r\n\r\n    const threadId = session.sessionId;\r\n\r\n    const message = await this.sendMessageToAssistant(\r\n      instance,\r\n      openaiBot,\r\n      remoteJid,\r\n      pushName,\r\n      fromMe,\r\n      content,\r\n      threadId,\r\n    );\r\n\r\n    await this.sendMessageWhatsapp(instance, session, remoteJid, settings, message);\r\n\r\n    return;\r\n  }\r\n\r\n  public async createChatCompletionNewSession(instance: InstanceDto, data: any) {\r\n    if (data.remoteJid === 'status@broadcast') return;\r\n\r\n    const id = Math.floor(Math.random() * 10000000000).toString();\r\n\r\n    const creds = await this.prismaRepository.openaiCreds.findFirst({\r\n      where: {\r\n        id: data.openaiCredsId,\r\n      },\r\n    });\r\n\r\n    if (!creds) throw new Error('Openai Creds not found');\r\n\r\n    try {\r\n      const session = await this.prismaRepository.integrationSession.create({\r\n        data: {\r\n          remoteJid: data.remoteJid,\r\n          pushName: data.pushName,\r\n          sessionId: id,\r\n          status: 'opened',\r\n          awaitUser: false,\r\n          botId: data.botId,\r\n          instanceId: instance.instanceId,\r\n          type: 'openai',\r\n        },\r\n      });\r\n\r\n      return { session, creds };\r\n    } catch (error) {\r\n      this.logger.error(error);\r\n      return;\r\n    }\r\n  }\r\n\r\n  private async initChatCompletionNewSession(\r\n    instance: any,\r\n    remoteJid: string,\r\n    pushName: string,\r\n    openaiBot: OpenaiBot,\r\n    settings: OpenaiSetting,\r\n    session: IntegrationSession,\r\n    content: string,\r\n  ) {\r\n    const data = await this.createChatCompletionNewSession(instance, {\r\n      remoteJid,\r\n      pushName,\r\n      openaiCredsId: openaiBot.openaiCredsId,\r\n      botId: openaiBot.id,\r\n    });\r\n\r\n    session = data.session;\r\n\r\n    const creds = data.creds;\r\n\r\n    this.client = new OpenAI({\r\n      apiKey: creds.apiKey,\r\n    });\r\n\r\n    const message = await this.sendMessageToBot(instance, openaiBot, remoteJid, content);\r\n\r\n    await this.sendMessageWhatsapp(instance, session, remoteJid, settings, message);\r\n\r\n    return;\r\n  }\r\n\r\n  public async processOpenaiChatCompletion(\r\n    instance: any,\r\n    remoteJid: string,\r\n    pushName: string,\r\n    openaiBot: OpenaiBot,\r\n    session: IntegrationSession,\r\n    settings: OpenaiSetting,\r\n    content: string,\r\n  ) {\r\n    if (session && session.status !== 'opened') {\r\n      return;\r\n    }\r\n\r\n    if (session && settings.expire && settings.expire > 0) {\r\n      const now = Date.now();\r\n\r\n      const sessionUpdatedAt = new Date(session.updatedAt).getTime();\r\n\r\n      const diff = now - sessionUpdatedAt;\r\n\r\n      const diffInMinutes = Math.floor(diff / 1000 / 60);\r\n\r\n      if (diffInMinutes > settings.expire) {\r\n        if (settings.keepOpen) {\r\n          await this.prismaRepository.integrationSession.update({\r\n            where: {\r\n              id: session.id,\r\n            },\r\n            data: {\r\n              status: 'closed',\r\n            },\r\n          });\r\n        } else {\r\n          await this.prismaRepository.integrationSession.deleteMany({\r\n            where: {\r\n              botId: openaiBot.id,\r\n              remoteJid: remoteJid,\r\n            },\r\n          });\r\n        }\r\n\r\n        await this.initChatCompletionNewSession(instance, remoteJid, pushName, openaiBot, settings, session, content);\r\n        return;\r\n      }\r\n    }\r\n\r\n    if (!session) {\r\n      await this.initChatCompletionNewSession(instance, remoteJid, pushName, openaiBot, settings, session, content);\r\n      return;\r\n    }\r\n\r\n    await this.prismaRepository.integrationSession.update({\r\n      where: {\r\n        id: session.id,\r\n      },\r\n      data: {\r\n        status: 'opened',\r\n        awaitUser: false,\r\n      },\r\n    });\r\n\r\n    if (!content) {\r\n      if (settings.unknownMessage) {\r\n        this.waMonitor.waInstances[instance.instanceName].textMessage(\r\n          {\r\n            number: remoteJid.split('@')[0],\r\n            delay: settings.delayMessage || 1000,\r\n            text: settings.unknownMessage,\r\n          },\r\n          false,\r\n        );\r\n\r\n        sendTelemetry('/message/sendText');\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (settings.keywordFinish && content.toLowerCase() === settings.keywordFinish.toLowerCase()) {\r\n      if (settings.keepOpen) {\r\n        await this.prismaRepository.integrationSession.update({\r\n          where: {\r\n            id: session.id,\r\n          },\r\n          data: {\r\n            status: 'closed',\r\n          },\r\n        });\r\n      } else {\r\n        await this.prismaRepository.integrationSession.deleteMany({\r\n          where: {\r\n            botId: openaiBot.id,\r\n            remoteJid: remoteJid,\r\n          },\r\n        });\r\n      }\r\n      return;\r\n    }\r\n\r\n    const creds = await this.prismaRepository.openaiCreds.findFirst({\r\n      where: {\r\n        id: openaiBot.openaiCredsId,\r\n      },\r\n    });\r\n\r\n    if (!creds) throw new Error('Openai Creds not found');\r\n\r\n    this.client = new OpenAI({\r\n      apiKey: creds.apiKey,\r\n    });\r\n\r\n    const message = await this.sendMessageToBot(instance, openaiBot, remoteJid, content);\r\n\r\n    await this.sendMessageWhatsapp(instance, session, remoteJid, settings, message);\r\n\r\n    return;\r\n  }\r\n\r\n  public async speechToText(creds: OpenaiCreds, msg: any, updateMediaMessage: any) {\r\n    let audio;\r\n\r\n    if (msg?.message?.mediaUrl) {\r\n      audio = await axios.get(msg.message.mediaUrl, { responseType: 'arraybuffer' }).then((response) => {\r\n        return Buffer.from(response.data, 'binary');\r\n      });\r\n    } else {\r\n      audio = await downloadMediaMessage(\r\n        { key: msg.key, message: msg?.message },\r\n        'buffer',\r\n        {},\r\n        {\r\n          logger: P({ level: 'error' }) as any,\r\n          reuploadRequest: updateMediaMessage,\r\n        },\r\n      );\r\n    }\r\n\r\n    const lang = this.configService.get<Language>('LANGUAGE').includes('pt')\r\n      ? 'pt'\r\n      : this.configService.get<Language>('LANGUAGE');\r\n\r\n    const formData = new FormData();\r\n\r\n    formData.append('file', audio, 'audio.ogg');\r\n    formData.append('model', 'whisper-1');\r\n    formData.append('language', lang);\r\n\r\n    const response = await axios.post('https://api.openai.com/v1/audio/transcriptions', formData, {\r\n      headers: {\r\n        'Content-Type': 'multipart/form-data',\r\n        Authorization: `Bearer ${creds.apiKey}`,\r\n      },\r\n    });\r\n\r\n    return response?.data?.text;\r\n  }\r\n}\r\n","/* eslint-disable @typescript-eslint/no-namespace */\r\nimport { JsonValue } from '@prisma/client/runtime/library';\r\nimport { AuthenticationState, WAConnectionState } from 'baileys';\r\n\r\nexport enum Events {\r\n  APPLICATION_STARTUP = 'application.startup',\r\n  INSTANCE_CREATE = 'instance.create',\r\n  INSTANCE_DELETE = 'instance.delete',\r\n  QRCODE_UPDATED = 'qrcode.updated',\r\n  CONNECTION_UPDATE = 'connection.update',\r\n  STATUS_INSTANCE = 'status.instance',\r\n  MESSAGES_SET = 'messages.set',\r\n  MESSAGES_UPSERT = 'messages.upsert',\r\n  MESSAGES_EDITED = 'messages.edited',\r\n  MESSAGES_UPDATE = 'messages.update',\r\n  MESSAGES_DELETE = 'messages.delete',\r\n  SEND_MESSAGE = 'send.message',\r\n  CONTACTS_SET = 'contacts.set',\r\n  CONTACTS_UPSERT = 'contacts.upsert',\r\n  CONTACTS_UPDATE = 'contacts.update',\r\n  PRESENCE_UPDATE = 'presence.update',\r\n  CHATS_SET = 'chats.set',\r\n  CHATS_UPDATE = 'chats.update',\r\n  CHATS_UPSERT = 'chats.upsert',\r\n  CHATS_DELETE = 'chats.delete',\r\n  GROUPS_UPSERT = 'groups.upsert',\r\n  GROUPS_UPDATE = 'groups.update',\r\n  GROUP_PARTICIPANTS_UPDATE = 'group-participants.update',\r\n  CALL = 'call',\r\n  TYPEBOT_START = 'typebot.start',\r\n  TYPEBOT_CHANGE_STATUS = 'typebot.change-status',\r\n  LABELS_EDIT = 'labels.edit',\r\n  LABELS_ASSOCIATION = 'labels.association',\r\n  CREDS_UPDATE = 'creds.update',\r\n  MESSAGING_HISTORY_SET = 'messaging-history.set',\r\n  REMOVE_INSTANCE = 'remove.instance',\r\n  LOGOUT_INSTANCE = 'logout.instance',\r\n}\r\n\r\nexport declare namespace wa {\r\n  export type QrCode = {\r\n    count?: number;\r\n    pairingCode?: string;\r\n    base64?: string;\r\n    code?: string;\r\n  };\r\n\r\n  export type Instance = {\r\n    id?: string;\r\n    qrcode?: QrCode;\r\n    pairingCode?: string;\r\n    authState?: { state: AuthenticationState; saveCreds: () => void };\r\n    name?: string;\r\n    wuid?: string;\r\n    profileName?: string;\r\n    profilePictureUrl?: string;\r\n    token?: string;\r\n    number?: string;\r\n    integration?: string;\r\n    businessId?: string;\r\n  };\r\n\r\n  export type LocalChatwoot = {\r\n    enabled?: boolean;\r\n    accountId?: string;\r\n    token?: string;\r\n    url?: string;\r\n    nameInbox?: string;\r\n    signMsg?: boolean;\r\n    signDelimiter?: string;\r\n    number?: string;\r\n    reopenConversation?: boolean;\r\n    conversationPending?: boolean;\r\n    mergeBrazilContacts?: boolean;\r\n    importContacts?: boolean;\r\n    importMessages?: boolean;\r\n    daysLimitImportMessages?: number;\r\n  };\r\n\r\n  export type LocalSettings = {\r\n    rejectCall?: boolean;\r\n    msgCall?: string;\r\n    groupsIgnore?: boolean;\r\n    alwaysOnline?: boolean;\r\n    readMessages?: boolean;\r\n    readStatus?: boolean;\r\n    syncFullHistory?: boolean;\r\n    wavoipToken?: string;\r\n  };\r\n\r\n  export type LocalEvent = {\r\n    enabled?: boolean;\r\n    events?: JsonValue;\r\n  };\r\n\r\n  export type LocalWebHook = LocalEvent & {\r\n    url?: string;\r\n    headers?: JsonValue;\r\n    webhookByEvents?: boolean;\r\n    webhookBase64?: boolean;\r\n  };\r\n\r\n  export type LocalPusher = LocalEvent & {\r\n    appId?: string;\r\n    key?: string;\r\n    secret?: string;\r\n    cluster?: string;\r\n    useTLS?: boolean;\r\n  };\r\n\r\n  type Session = {\r\n    remoteJid?: string;\r\n    sessionId?: string;\r\n    createdAt?: number;\r\n  };\r\n\r\n  export type LocalProxy = {\r\n    enabled?: boolean;\r\n    host?: string;\r\n    port?: string;\r\n    protocol?: string;\r\n    username?: string;\r\n    password?: string;\r\n  };\r\n\r\n  export type StateConnection = {\r\n    instance?: string;\r\n    state?: WAConnectionState | 'refused';\r\n    statusReason?: number;\r\n  };\r\n\r\n  export type StatusMessage = 'ERROR' | 'PENDING' | 'SERVER_ACK' | 'DELIVERY_ACK' | 'READ' | 'DELETED' | 'PLAYED';\r\n}\r\n\r\nexport const TypeMediaMessage = [\r\n  'imageMessage',\r\n  'documentMessage',\r\n  'audioMessage',\r\n  'videoMessage',\r\n  'stickerMessage',\r\n  'ptvMessage',\r\n];\r\n\r\nexport const MessageSubtype = [\r\n  'ephemeralMessage',\r\n  'documentWithCaptionMessage',\r\n  'viewOnceMessage',\r\n  'viewOnceMessageV2',\r\n];\r\n\r\nexport const Integration = {\r\n  WHATSAPP_BUSINESS: 'WHATSAPP-BUSINESS',\r\n  WHATSAPP_BAILEYS: 'WHATSAPP-BAILEYS',\r\n  EVOLUTION: 'EVOLUTION',\r\n};\r\n","import dayjs from 'dayjs';\r\nimport fs from 'fs';\r\n\r\nimport { configService, Log } from './env.config';\r\nconst packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf8'));\r\n\r\nconst formatDateLog = (timestamp: number) =>\r\n  dayjs(timestamp)\r\n    .toDate()\r\n    .toString()\r\n    .replace(/\\sGMT.+/, '');\r\n\r\nenum Color {\r\n  LOG = '\\x1b[32m',\r\n  INFO = '\\x1b[34m',\r\n  WARN = '\\x1b[33m',\r\n  ERROR = '\\x1b[31m',\r\n  DEBUG = '\\x1b[36m',\r\n  VERBOSE = '\\x1b[37m',\r\n  DARK = '\\x1b[30m',\r\n}\r\n\r\nenum Command {\r\n  RESET = '\\x1b[0m',\r\n  BRIGHT = '\\x1b[1m',\r\n  UNDERSCORE = '\\x1b[4m',\r\n}\r\n\r\nenum Level {\r\n  LOG = Color.LOG + '%s' + Command.RESET,\r\n  DARK = Color.DARK + '%s' + Command.RESET,\r\n  INFO = Color.INFO + '%s' + Command.RESET,\r\n  WARN = Color.WARN + '%s' + Command.RESET,\r\n  ERROR = Color.ERROR + '%s' + Command.RESET,\r\n  DEBUG = Color.DEBUG + '%s' + Command.RESET,\r\n  VERBOSE = Color.VERBOSE + '%s' + Command.RESET,\r\n}\r\n\r\nenum Type {\r\n  LOG = 'LOG',\r\n  WARN = 'WARN',\r\n  INFO = 'INFO',\r\n  DARK = 'DARK',\r\n  ERROR = 'ERROR',\r\n  DEBUG = 'DEBUG',\r\n  VERBOSE = 'VERBOSE',\r\n}\r\n\r\nenum Background {\r\n  LOG = '\\x1b[42m',\r\n  INFO = '\\x1b[44m',\r\n  WARN = '\\x1b[43m',\r\n  DARK = '\\x1b[40m',\r\n  ERROR = '\\x1b[41m',\r\n  DEBUG = '\\x1b[46m',\r\n  VERBOSE = '\\x1b[47m',\r\n}\r\n\r\nexport class Logger {\r\n  private readonly configService = configService;\r\n  private context: string;\r\n\r\n  constructor(context = 'Logger') {\r\n    this.context = context;\r\n  }\r\n\r\n  private instance = null;\r\n\r\n  public setContext(value: string) {\r\n    this.context = value;\r\n  }\r\n\r\n  public setInstance(value: string) {\r\n    this.instance = value;\r\n  }\r\n\r\n  private console(value: any, type: Type) {\r\n    const types: Type[] = [];\r\n\r\n    this.configService.get<Log>('LOG').LEVEL.forEach((level) => types.push(Type[level]));\r\n\r\n    const typeValue = typeof value;\r\n    if (types.includes(type)) {\r\n      if (configService.get<Log>('LOG').COLOR) {\r\n        console.log(\r\n          /*Command.UNDERSCORE +*/ Command.BRIGHT + Level[type],\r\n          '[Evolution API]',\r\n          Command.BRIGHT + Color[type],\r\n          this.instance ? `[${this.instance}]` : '',\r\n          Command.BRIGHT + Color[type],\r\n          `v${packageJson.version}`,\r\n          Command.BRIGHT + Color[type],\r\n          process.pid.toString(),\r\n          Command.RESET,\r\n          Command.BRIGHT + Color[type],\r\n          '-',\r\n          Command.BRIGHT + Color.VERBOSE,\r\n          `${formatDateLog(Date.now())}  `,\r\n          Command.RESET,\r\n          Color[type] + Background[type] + Command.BRIGHT,\r\n          `${type} ` + Command.RESET,\r\n          Color.WARN + Command.BRIGHT,\r\n          `[${this.context}]` + Command.RESET,\r\n          Color[type] + Command.BRIGHT,\r\n          `[${typeValue}]` + Command.RESET,\r\n          Color[type],\r\n          typeValue !== 'object' ? value : '',\r\n          Command.RESET,\r\n        );\r\n        typeValue === 'object' ? console.log(/*Level.DARK,*/ value, '\\n') : '';\r\n      } else {\r\n        console.log(\r\n          '[Evolution API]',\r\n          this.instance ? `[${this.instance}]` : '',\r\n          process.pid.toString(),\r\n          '-',\r\n          `${formatDateLog(Date.now())}  `,\r\n          `${type} `,\r\n          `[${this.context}]`,\r\n          `[${typeValue}]`,\r\n          value,\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  public log(value: any) {\r\n    this.console(value, Type.LOG);\r\n  }\r\n\r\n  public info(value: any) {\r\n    this.console(value, Type.INFO);\r\n  }\r\n\r\n  public warn(value: any) {\r\n    this.console(value, Type.WARN);\r\n  }\r\n\r\n  public error(value: any) {\r\n    this.console(value, Type.ERROR);\r\n  }\r\n\r\n  public verbose(value: any) {\r\n    this.console(value, Type.VERBOSE);\r\n  }\r\n\r\n  public debug(value: any) {\r\n    this.console(value, Type.DEBUG);\r\n  }\r\n\r\n  public dark(value: any) {\r\n    this.console(value, Type.DARK);\r\n  }\r\n}\r\n","import { isBooleanString } from 'class-validator';\r\nimport dotenv from 'dotenv';\r\n\r\ndotenv.config();\r\n\r\nexport type HttpServer = {\r\n  TYPE: 'http' | 'https';\r\n  PORT: number;\r\n  URL: string;\r\n  DISABLE_DOCS: boolean;\r\n  DISABLE_MANAGER: boolean;\r\n};\r\n\r\nexport type HttpMethods = 'POST' | 'GET' | 'PUT' | 'DELETE';\r\nexport type Cors = {\r\n  ORIGIN: string[];\r\n  METHODS: HttpMethods[];\r\n  CREDENTIALS: boolean;\r\n};\r\n\r\nexport type LogBaileys = 'fatal' | 'error' | 'warn' | 'info' | 'debug' | 'trace';\r\n\r\nexport type LogLevel = 'ERROR' | 'WARN' | 'DEBUG' | 'INFO' | 'LOG' | 'VERBOSE' | 'DARK' | 'WEBHOOKS' | 'WEBSOCKET';\r\n\r\nexport type Log = {\r\n  LEVEL: LogLevel[];\r\n  COLOR: boolean;\r\n  BAILEYS: LogBaileys;\r\n};\r\n\r\nexport type ProviderSession = {\r\n  ENABLED: boolean;\r\n  HOST: string;\r\n  PORT: string;\r\n  PREFIX: string;\r\n};\r\n\r\nexport type SaveData = {\r\n  INSTANCE: boolean;\r\n  HISTORIC: boolean;\r\n  NEW_MESSAGE: boolean;\r\n  MESSAGE_UPDATE: boolean;\r\n  CONTACTS: boolean;\r\n  CHATS: boolean;\r\n  LABELS: boolean;\r\n  IS_ON_WHATSAPP: boolean;\r\n  IS_ON_WHATSAPP_DAYS: number;\r\n};\r\n\r\nexport type DBConnection = {\r\n  URI: string;\r\n  CLIENT_NAME: string;\r\n};\r\nexport type Database = {\r\n  CONNECTION: DBConnection;\r\n  PROVIDER: string;\r\n  SAVE_DATA: SaveData;\r\n  DELETE_DATA: DeleteData;\r\n};\r\n\r\nexport type DeleteData = {\r\n  LOGICAL_MESSAGE_DELETE: boolean;\r\n};\r\nexport type EventsRabbitmq = {\r\n  APPLICATION_STARTUP: boolean;\r\n  INSTANCE_CREATE: boolean;\r\n  INSTANCE_DELETE: boolean;\r\n  QRCODE_UPDATED: boolean;\r\n  MESSAGES_SET: boolean;\r\n  MESSAGES_UPSERT: boolean;\r\n  MESSAGES_EDITED: boolean;\r\n  MESSAGES_UPDATE: boolean;\r\n  MESSAGES_DELETE: boolean;\r\n  SEND_MESSAGE: boolean;\r\n  CONTACTS_SET: boolean;\r\n  CONTACTS_UPDATE: boolean;\r\n  CONTACTS_UPSERT: boolean;\r\n  PRESENCE_UPDATE: boolean;\r\n  CHATS_SET: boolean;\r\n  CHATS_UPDATE: boolean;\r\n  CHATS_DELETE: boolean;\r\n  CHATS_UPSERT: boolean;\r\n  CONNECTION_UPDATE: boolean;\r\n  LABELS_EDIT: boolean;\r\n  LABELS_ASSOCIATION: boolean;\r\n  GROUPS_UPSERT: boolean;\r\n  GROUP_UPDATE: boolean;\r\n  GROUP_PARTICIPANTS_UPDATE: boolean;\r\n  CALL: boolean;\r\n  TYPEBOT_START: boolean;\r\n  TYPEBOT_CHANGE_STATUS: boolean;\r\n};\r\n\r\nexport type Rabbitmq = {\r\n  ENABLED: boolean;\r\n  URI: string;\r\n  EXCHANGE_NAME: string;\r\n  GLOBAL_ENABLED: boolean;\r\n  EVENTS: EventsRabbitmq;\r\n  PREFIX_KEY: string;\r\n};\r\n\r\nexport type Sqs = {\r\n  ENABLED: boolean;\r\n  ACCESS_KEY_ID: string;\r\n  SECRET_ACCESS_KEY: string;\r\n  ACCOUNT_ID: string;\r\n  REGION: string;\r\n};\r\n\r\nexport type Websocket = {\r\n  ENABLED: boolean;\r\n  GLOBAL_EVENTS: boolean;\r\n};\r\n\r\nexport type WaBusiness = {\r\n  TOKEN_WEBHOOK: string;\r\n  URL: string;\r\n  VERSION: string;\r\n  LANGUAGE: string;\r\n};\r\n\r\nexport type EventsWebhook = {\r\n  APPLICATION_STARTUP: boolean;\r\n  INSTANCE_CREATE: boolean;\r\n  INSTANCE_DELETE: boolean;\r\n  QRCODE_UPDATED: boolean;\r\n  MESSAGES_SET: boolean;\r\n  MESSAGES_UPSERT: boolean;\r\n  MESSAGES_EDITED: boolean;\r\n  MESSAGES_UPDATE: boolean;\r\n  MESSAGES_DELETE: boolean;\r\n  SEND_MESSAGE: boolean;\r\n  CONTACTS_SET: boolean;\r\n  CONTACTS_UPDATE: boolean;\r\n  CONTACTS_UPSERT: boolean;\r\n  PRESENCE_UPDATE: boolean;\r\n  CHATS_SET: boolean;\r\n  CHATS_UPDATE: boolean;\r\n  CHATS_DELETE: boolean;\r\n  CHATS_UPSERT: boolean;\r\n  CONNECTION_UPDATE: boolean;\r\n  LABELS_EDIT: boolean;\r\n  LABELS_ASSOCIATION: boolean;\r\n  GROUPS_UPSERT: boolean;\r\n  GROUP_UPDATE: boolean;\r\n  GROUP_PARTICIPANTS_UPDATE: boolean;\r\n  CALL: boolean;\r\n  TYPEBOT_START: boolean;\r\n  TYPEBOT_CHANGE_STATUS: boolean;\r\n  ERRORS: boolean;\r\n  ERRORS_WEBHOOK: string;\r\n};\r\n\r\nexport type EventsPusher = {\r\n  APPLICATION_STARTUP: boolean;\r\n  INSTANCE_CREATE: boolean;\r\n  INSTANCE_DELETE: boolean;\r\n  QRCODE_UPDATED: boolean;\r\n  MESSAGES_SET: boolean;\r\n  MESSAGES_UPSERT: boolean;\r\n  MESSAGES_EDITED: boolean;\r\n  MESSAGES_UPDATE: boolean;\r\n  MESSAGES_DELETE: boolean;\r\n  SEND_MESSAGE: boolean;\r\n  CONTACTS_SET: boolean;\r\n  CONTACTS_UPDATE: boolean;\r\n  CONTACTS_UPSERT: boolean;\r\n  PRESENCE_UPDATE: boolean;\r\n  CHATS_SET: boolean;\r\n  CHATS_UPDATE: boolean;\r\n  CHATS_DELETE: boolean;\r\n  CHATS_UPSERT: boolean;\r\n  CONNECTION_UPDATE: boolean;\r\n  LABELS_EDIT: boolean;\r\n  LABELS_ASSOCIATION: boolean;\r\n  GROUPS_UPSERT: boolean;\r\n  GROUP_UPDATE: boolean;\r\n  GROUP_PARTICIPANTS_UPDATE: boolean;\r\n  CALL: boolean;\r\n  TYPEBOT_START: boolean;\r\n  TYPEBOT_CHANGE_STATUS: boolean;\r\n};\r\n\r\nexport type ApiKey = { KEY: string };\r\n\r\nexport type Auth = {\r\n  API_KEY: ApiKey;\r\n  EXPOSE_IN_FETCH_INSTANCES: boolean;\r\n};\r\n\r\nexport type DelInstance = number | boolean;\r\n\r\nexport type Language = string | 'en';\r\n\r\nexport type GlobalWebhook = {\r\n  URL: string;\r\n  ENABLED: boolean;\r\n  WEBHOOK_BY_EVENTS: boolean;\r\n};\r\n\r\nexport type GlobalPusher = {\r\n  ENABLED: boolean;\r\n  APP_ID: string;\r\n  KEY: string;\r\n  SECRET: string;\r\n  CLUSTER: string;\r\n  USE_TLS: boolean;\r\n};\r\n\r\nexport type CacheConfRedis = {\r\n  ENABLED: boolean;\r\n  URI: string;\r\n  PREFIX_KEY: string;\r\n  TTL: number;\r\n  SAVE_INSTANCES: boolean;\r\n};\r\nexport type CacheConfLocal = {\r\n  ENABLED: boolean;\r\n  TTL: number;\r\n};\r\nexport type SslConf = { PRIVKEY: string; FULLCHAIN: string };\r\nexport type Webhook = { GLOBAL?: GlobalWebhook; EVENTS: EventsWebhook };\r\nexport type Pusher = { ENABLED: boolean; GLOBAL?: GlobalPusher; EVENTS: EventsPusher };\r\nexport type ConfigSessionPhone = { CLIENT: string; NAME: string; VERSION: string };\r\nexport type QrCode = { LIMIT: number; COLOR: string };\r\nexport type Typebot = { ENABLED: boolean; API_VERSION: string; SEND_MEDIA_BASE64: boolean };\r\nexport type Chatwoot = {\r\n  ENABLED: boolean;\r\n  MESSAGE_DELETE: boolean;\r\n  MESSAGE_READ: boolean;\r\n  BOT_CONTACT: boolean;\r\n  IMPORT: {\r\n    DATABASE: {\r\n      CONNECTION: {\r\n        URI: string;\r\n      };\r\n    };\r\n    PLACEHOLDER_MEDIA_MESSAGE: boolean;\r\n  };\r\n};\r\nexport type Openai = { ENABLED: boolean; API_KEY_GLOBAL?: string };\r\nexport type Dify = { ENABLED: boolean };\r\n\r\nexport type S3 = {\r\n  ACCESS_KEY: string;\r\n  SECRET_KEY: string;\r\n  ENDPOINT: string;\r\n  BUCKET_NAME: string;\r\n  ENABLE: boolean;\r\n  PORT?: number;\r\n  USE_SSL?: boolean;\r\n  REGION?: string;\r\n};\r\n\r\nexport type CacheConf = { REDIS: CacheConfRedis; LOCAL: CacheConfLocal };\r\nexport type Production = boolean;\r\n\r\nexport interface Env {\r\n  SERVER: HttpServer;\r\n  CORS: Cors;\r\n  SSL_CONF: SslConf;\r\n  PROVIDER: ProviderSession;\r\n  DATABASE: Database;\r\n  RABBITMQ: Rabbitmq;\r\n  SQS: Sqs;\r\n  WEBSOCKET: Websocket;\r\n  WA_BUSINESS: WaBusiness;\r\n  LOG: Log;\r\n  DEL_INSTANCE: DelInstance;\r\n  DEL_TEMP_INSTANCES: boolean;\r\n  LANGUAGE: Language;\r\n  WEBHOOK: Webhook;\r\n  PUSHER: Pusher;\r\n  CONFIG_SESSION_PHONE: ConfigSessionPhone;\r\n  QRCODE: QrCode;\r\n  TYPEBOT: Typebot;\r\n  CHATWOOT: Chatwoot;\r\n  OPENAI: Openai;\r\n  DIFY: Dify;\r\n  CACHE: CacheConf;\r\n  S3?: S3;\r\n  AUTHENTICATION: Auth;\r\n  PRODUCTION?: Production;\r\n}\r\n\r\nexport type Key = keyof Env;\r\n\r\nexport class ConfigService {\r\n  constructor() {\r\n    this.loadEnv();\r\n  }\r\n\r\n  private env: Env;\r\n\r\n  public get<T = any>(key: Key) {\r\n    return this.env[key] as T;\r\n  }\r\n\r\n  private loadEnv() {\r\n    this.env = this.envProcess();\r\n    this.env.PRODUCTION = process.env?.NODE_ENV === 'PROD';\r\n    if (process.env?.DOCKER_ENV === 'true') {\r\n      this.env.SERVER.TYPE = process.env.SERVER_TYPE as 'http' | 'http';\r\n      this.env.SERVER.PORT = Number.parseInt(process.env.SERVER_PORT) || 8080;\r\n    }\r\n  }\r\n\r\n  private envProcess(): Env {\r\n    return {\r\n      SERVER: {\r\n        TYPE: (process.env.SERVER_TYPE as 'http' | 'https') || 'http',\r\n        PORT: Number.parseInt(process.env.SERVER_PORT) || 8080,\r\n        URL: process.env.SERVER_URL,\r\n        DISABLE_DOCS: process.env?.SERVER_DISABLE_DOCS === 'true',\r\n        DISABLE_MANAGER: process.env?.SERVER_DISABLE_MANAGER === 'true',\r\n      },\r\n      CORS: {\r\n        ORIGIN: process.env.CORS_ORIGIN?.split(',') || ['*'],\r\n        METHODS:\r\n          (process.env.CORS_METHODS?.split(',') as HttpMethods[]) ||\r\n          (['POST', 'GET', 'PUT', 'DELETE'] as HttpMethods[]),\r\n        CREDENTIALS: process.env?.CORS_CREDENTIALS === 'true',\r\n      },\r\n      SSL_CONF: {\r\n        PRIVKEY: process.env?.SSL_CONF_PRIVKEY || '',\r\n        FULLCHAIN: process.env?.SSL_CONF_FULLCHAIN || '',\r\n      },\r\n      PROVIDER: {\r\n        ENABLED: process.env?.PROVIDER_ENABLED === 'true',\r\n        HOST: process.env.PROVIDER_HOST,\r\n        PORT: process.env?.PROVIDER_PORT || '5656',\r\n        PREFIX: process.env?.PROVIDER_PREFIX || 'evolution',\r\n      },\r\n      DATABASE: {\r\n        CONNECTION: {\r\n          URI: process.env.DATABASE_CONNECTION_URI || '',\r\n          CLIENT_NAME: process.env.DATABASE_CONNECTION_CLIENT_NAME || 'evolution',\r\n        },\r\n        PROVIDER: process.env.DATABASE_PROVIDER || 'postgresql',\r\n        SAVE_DATA: {\r\n          INSTANCE: process.env?.DATABASE_SAVE_DATA_INSTANCE === 'true',\r\n          NEW_MESSAGE: process.env?.DATABASE_SAVE_DATA_NEW_MESSAGE === 'true',\r\n          MESSAGE_UPDATE: process.env?.DATABASE_SAVE_MESSAGE_UPDATE === 'true',\r\n          CONTACTS: process.env?.DATABASE_SAVE_DATA_CONTACTS === 'true',\r\n          CHATS: process.env?.DATABASE_SAVE_DATA_CHATS === 'true',\r\n          HISTORIC: process.env?.DATABASE_SAVE_DATA_HISTORIC === 'true',\r\n          LABELS: process.env?.DATABASE_SAVE_DATA_LABELS === 'true',\r\n          IS_ON_WHATSAPP: process.env?.DATABASE_SAVE_IS_ON_WHATSAPP === 'true',\r\n          IS_ON_WHATSAPP_DAYS: Number.parseInt(process.env?.DATABASE_SAVE_IS_ON_WHATSAPP_DAYS ?? '7'),\r\n        },\r\n        DELETE_DATA: {\r\n          LOGICAL_MESSAGE_DELETE: process.env?.DATABASE_DELETE_MESSAGE === 'true',\r\n        },\r\n      },\r\n      RABBITMQ: {\r\n        ENABLED: process.env?.RABBITMQ_ENABLED === 'true',\r\n        GLOBAL_ENABLED: process.env?.RABBITMQ_GLOBAL_ENABLED === 'true',\r\n        PREFIX_KEY: process.env?.RABBITMQ_PREFIX_KEY || 'evolution',\r\n        EXCHANGE_NAME: process.env?.RABBITMQ_EXCHANGE_NAME || 'evolution_exchange',\r\n        URI: process.env.RABBITMQ_URI || '',\r\n        EVENTS: {\r\n          APPLICATION_STARTUP: process.env?.RABBITMQ_EVENTS_APPLICATION_STARTUP === 'true',\r\n          INSTANCE_CREATE: process.env?.RABBITMQ_EVENTS_INSTANCE_CREATE === 'true',\r\n          INSTANCE_DELETE: process.env?.RABBITMQ_EVENTS_INSTANCE_DELETE === 'true',\r\n          QRCODE_UPDATED: process.env?.RABBITMQ_EVENTS_QRCODE_UPDATED === 'true',\r\n          MESSAGES_SET: process.env?.RABBITMQ_EVENTS_MESSAGES_SET === 'true',\r\n          MESSAGES_UPSERT: process.env?.RABBITMQ_EVENTS_MESSAGES_UPSERT === 'true',\r\n          MESSAGES_EDITED: process.env?.RABBITMQ_EVENTS_MESSAGES_EDITED === 'true',\r\n          MESSAGES_UPDATE: process.env?.RABBITMQ_EVENTS_MESSAGES_UPDATE === 'true',\r\n          MESSAGES_DELETE: process.env?.RABBITMQ_EVENTS_MESSAGES_DELETE === 'true',\r\n          SEND_MESSAGE: process.env?.RABBITMQ_EVENTS_SEND_MESSAGE === 'true',\r\n          CONTACTS_SET: process.env?.RABBITMQ_EVENTS_CONTACTS_SET === 'true',\r\n          CONTACTS_UPDATE: process.env?.RABBITMQ_EVENTS_CONTACTS_UPDATE === 'true',\r\n          CONTACTS_UPSERT: process.env?.RABBITMQ_EVENTS_CONTACTS_UPSERT === 'true',\r\n          PRESENCE_UPDATE: process.env?.RABBITMQ_EVENTS_PRESENCE_UPDATE === 'true',\r\n          CHATS_SET: process.env?.RABBITMQ_EVENTS_CHATS_SET === 'true',\r\n          CHATS_UPDATE: process.env?.RABBITMQ_EVENTS_CHATS_UPDATE === 'true',\r\n          CHATS_UPSERT: process.env?.RABBITMQ_EVENTS_CHATS_UPSERT === 'true',\r\n          CHATS_DELETE: process.env?.RABBITMQ_EVENTS_CHATS_DELETE === 'true',\r\n          CONNECTION_UPDATE: process.env?.RABBITMQ_EVENTS_CONNECTION_UPDATE === 'true',\r\n          LABELS_EDIT: process.env?.RABBITMQ_EVENTS_LABELS_EDIT === 'true',\r\n          LABELS_ASSOCIATION: process.env?.RABBITMQ_EVENTS_LABELS_ASSOCIATION === 'true',\r\n          GROUPS_UPSERT: process.env?.RABBITMQ_EVENTS_GROUPS_UPSERT === 'true',\r\n          GROUP_UPDATE: process.env?.RABBITMQ_EVENTS_GROUPS_UPDATE === 'true',\r\n          GROUP_PARTICIPANTS_UPDATE: process.env?.RABBITMQ_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\r\n          CALL: process.env?.RABBITMQ_EVENTS_CALL === 'true',\r\n          TYPEBOT_START: process.env?.RABBITMQ_EVENTS_TYPEBOT_START === 'true',\r\n          TYPEBOT_CHANGE_STATUS: process.env?.RABBITMQ_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\r\n        },\r\n      },\r\n      SQS: {\r\n        ENABLED: process.env?.SQS_ENABLED === 'true',\r\n        ACCESS_KEY_ID: process.env.SQS_ACCESS_KEY_ID || '',\r\n        SECRET_ACCESS_KEY: process.env.SQS_SECRET_ACCESS_KEY || '',\r\n        ACCOUNT_ID: process.env.SQS_ACCOUNT_ID || '',\r\n        REGION: process.env.SQS_REGION || '',\r\n      },\r\n      WEBSOCKET: {\r\n        ENABLED: process.env?.WEBSOCKET_ENABLED === 'true',\r\n        GLOBAL_EVENTS: process.env?.WEBSOCKET_GLOBAL_EVENTS === 'true',\r\n      },\r\n      PUSHER: {\r\n        ENABLED: process.env?.PUSHER_ENABLED === 'true',\r\n        GLOBAL: {\r\n          ENABLED: process.env?.PUSHER_GLOBAL_ENABLED === 'true',\r\n          APP_ID: process.env?.PUSHER_GLOBAL_APP_ID || '',\r\n          KEY: process.env?.PUSHER_GLOBAL_KEY || '',\r\n          SECRET: process.env?.PUSHER_GLOBAL_SECRET || '',\r\n          CLUSTER: process.env?.PUSHER_GLOBAL_CLUSTER || '',\r\n          USE_TLS: process.env?.PUSHER_GLOBAL_USE_TLS === 'true',\r\n        },\r\n        EVENTS: {\r\n          APPLICATION_STARTUP: process.env?.PUSHER_EVENTS_APPLICATION_STARTUP === 'true',\r\n          INSTANCE_CREATE: process.env?.PUSHER_EVENTS_INSTANCE_CREATE === 'true',\r\n          INSTANCE_DELETE: process.env?.PUSHER_EVENTS_INSTANCE_DELETE === 'true',\r\n          QRCODE_UPDATED: process.env?.PUSHER_EVENTS_QRCODE_UPDATED === 'true',\r\n          MESSAGES_SET: process.env?.PUSHER_EVENTS_MESSAGES_SET === 'true',\r\n          MESSAGES_UPSERT: process.env?.PUSHER_EVENTS_MESSAGES_UPSERT === 'true',\r\n          MESSAGES_EDITED: process.env?.PUSHER_EVENTS_MESSAGES_EDITED === 'true',\r\n          MESSAGES_UPDATE: process.env?.PUSHER_EVENTS_MESSAGES_UPDATE === 'true',\r\n          MESSAGES_DELETE: process.env?.PUSHER_EVENTS_MESSAGES_DELETE === 'true',\r\n          SEND_MESSAGE: process.env?.PUSHER_EVENTS_SEND_MESSAGE === 'true',\r\n          CONTACTS_SET: process.env?.PUSHER_EVENTS_CONTACTS_SET === 'true',\r\n          CONTACTS_UPDATE: process.env?.PUSHER_EVENTS_CONTACTS_UPDATE === 'true',\r\n          CONTACTS_UPSERT: process.env?.PUSHER_EVENTS_CONTACTS_UPSERT === 'true',\r\n          PRESENCE_UPDATE: process.env?.PUSHER_EVENTS_PRESENCE_UPDATE === 'true',\r\n          CHATS_SET: process.env?.PUSHER_EVENTS_CHATS_SET === 'true',\r\n          CHATS_UPDATE: process.env?.PUSHER_EVENTS_CHATS_UPDATE === 'true',\r\n          CHATS_UPSERT: process.env?.PUSHER_EVENTS_CHATS_UPSERT === 'true',\r\n          CHATS_DELETE: process.env?.PUSHER_EVENTS_CHATS_DELETE === 'true',\r\n          CONNECTION_UPDATE: process.env?.PUSHER_EVENTS_CONNECTION_UPDATE === 'true',\r\n          LABELS_EDIT: process.env?.PUSHER_EVENTS_LABELS_EDIT === 'true',\r\n          LABELS_ASSOCIATION: process.env?.PUSHER_EVENTS_LABELS_ASSOCIATION === 'true',\r\n          GROUPS_UPSERT: process.env?.PUSHER_EVENTS_GROUPS_UPSERT === 'true',\r\n          GROUP_UPDATE: process.env?.PUSHER_EVENTS_GROUPS_UPDATE === 'true',\r\n          GROUP_PARTICIPANTS_UPDATE: process.env?.PUSHER_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\r\n          CALL: process.env?.PUSHER_EVENTS_CALL === 'true',\r\n          TYPEBOT_START: process.env?.PUSHER_EVENTS_TYPEBOT_START === 'true',\r\n          TYPEBOT_CHANGE_STATUS: process.env?.PUSHER_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\r\n        },\r\n      },\r\n      WA_BUSINESS: {\r\n        TOKEN_WEBHOOK: process.env.WA_BUSINESS_TOKEN_WEBHOOK || 'evolution',\r\n        URL: process.env.WA_BUSINESS_URL || 'https://graph.facebook.com',\r\n        VERSION: process.env.WA_BUSINESS_VERSION || 'v18.0',\r\n        LANGUAGE: process.env.WA_BUSINESS_LANGUAGE || 'en',\r\n      },\r\n      LOG: {\r\n        LEVEL:\r\n          (process.env?.LOG_LEVEL?.split(',') as LogLevel[]) ||\r\n          (['ERROR', 'WARN', 'DEBUG', 'INFO', 'LOG', 'VERBOSE', 'DARK', 'WEBHOOKS', 'WEBSOCKET'] as LogLevel[]),\r\n        COLOR: process.env?.LOG_COLOR === 'true',\r\n        BAILEYS: (process.env?.LOG_BAILEYS as LogBaileys) || 'error',\r\n      },\r\n      DEL_INSTANCE: isBooleanString(process.env?.DEL_INSTANCE)\r\n        ? process.env.DEL_INSTANCE === 'true'\r\n        : Number.parseInt(process.env.DEL_INSTANCE) || false,\r\n      DEL_TEMP_INSTANCES: isBooleanString(process.env?.DEL_TEMP_INSTANCES)\r\n        ? process.env.DEL_TEMP_INSTANCES === 'true'\r\n        : true,\r\n      LANGUAGE: process.env?.LANGUAGE || 'en',\r\n      WEBHOOK: {\r\n        GLOBAL: {\r\n          URL: process.env?.WEBHOOK_GLOBAL_URL || '',\r\n          ENABLED: process.env?.WEBHOOK_GLOBAL_ENABLED === 'true',\r\n          WEBHOOK_BY_EVENTS: process.env?.WEBHOOK_GLOBAL_WEBHOOK_BY_EVENTS === 'true',\r\n        },\r\n        EVENTS: {\r\n          APPLICATION_STARTUP: process.env?.WEBHOOK_EVENTS_APPLICATION_STARTUP === 'true',\r\n          INSTANCE_CREATE: process.env?.WEBHOOK_EVENTS_INSTANCE_CREATE === 'true',\r\n          INSTANCE_DELETE: process.env?.WEBHOOK_EVENTS_INSTANCE_DELETE === 'true',\r\n          QRCODE_UPDATED: process.env?.WEBHOOK_EVENTS_QRCODE_UPDATED === 'true',\r\n          MESSAGES_SET: process.env?.WEBHOOK_EVENTS_MESSAGES_SET === 'true',\r\n          MESSAGES_UPSERT: process.env?.WEBHOOK_EVENTS_MESSAGES_UPSERT === 'true',\r\n          MESSAGES_EDITED: process.env?.WEBHOOK_EVENTS_MESSAGES_EDITED === 'true',\r\n          MESSAGES_UPDATE: process.env?.WEBHOOK_EVENTS_MESSAGES_UPDATE === 'true',\r\n          MESSAGES_DELETE: process.env?.WEBHOOK_EVENTS_MESSAGES_DELETE === 'true',\r\n          SEND_MESSAGE: process.env?.WEBHOOK_EVENTS_SEND_MESSAGE === 'true',\r\n          CONTACTS_SET: process.env?.WEBHOOK_EVENTS_CONTACTS_SET === 'true',\r\n          CONTACTS_UPDATE: process.env?.WEBHOOK_EVENTS_CONTACTS_UPDATE === 'true',\r\n          CONTACTS_UPSERT: process.env?.WEBHOOK_EVENTS_CONTACTS_UPSERT === 'true',\r\n          PRESENCE_UPDATE: process.env?.WEBHOOK_EVENTS_PRESENCE_UPDATE === 'true',\r\n          CHATS_SET: process.env?.WEBHOOK_EVENTS_CHATS_SET === 'true',\r\n          CHATS_UPDATE: process.env?.WEBHOOK_EVENTS_CHATS_UPDATE === 'true',\r\n          CHATS_UPSERT: process.env?.WEBHOOK_EVENTS_CHATS_UPSERT === 'true',\r\n          CHATS_DELETE: process.env?.WEBHOOK_EVENTS_CHATS_DELETE === 'true',\r\n          CONNECTION_UPDATE: process.env?.WEBHOOK_EVENTS_CONNECTION_UPDATE === 'true',\r\n          LABELS_EDIT: process.env?.WEBHOOK_EVENTS_LABELS_EDIT === 'true',\r\n          LABELS_ASSOCIATION: process.env?.WEBHOOK_EVENTS_LABELS_ASSOCIATION === 'true',\r\n          GROUPS_UPSERT: process.env?.WEBHOOK_EVENTS_GROUPS_UPSERT === 'true',\r\n          GROUP_UPDATE: process.env?.WEBHOOK_EVENTS_GROUPS_UPDATE === 'true',\r\n          GROUP_PARTICIPANTS_UPDATE: process.env?.WEBHOOK_EVENTS_GROUP_PARTICIPANTS_UPDATE === 'true',\r\n          CALL: process.env?.WEBHOOK_EVENTS_CALL === 'true',\r\n          TYPEBOT_START: process.env?.WEBHOOK_EVENTS_TYPEBOT_START === 'true',\r\n          TYPEBOT_CHANGE_STATUS: process.env?.WEBHOOK_EVENTS_TYPEBOT_CHANGE_STATUS === 'true',\r\n          ERRORS: process.env?.WEBHOOK_EVENTS_ERRORS === 'true',\r\n          ERRORS_WEBHOOK: process.env?.WEBHOOK_EVENTS_ERRORS_WEBHOOK || '',\r\n        },\r\n      },\r\n      CONFIG_SESSION_PHONE: {\r\n        CLIENT: process.env?.CONFIG_SESSION_PHONE_CLIENT || 'Evolution API',\r\n        NAME: process.env?.CONFIG_SESSION_PHONE_NAME || 'Chrome',\r\n        VERSION: process.env?.CONFIG_SESSION_PHONE_VERSION || null,\r\n      },\r\n      QRCODE: {\r\n        LIMIT: Number.parseInt(process.env.QRCODE_LIMIT) || 30,\r\n        COLOR: process.env.QRCODE_COLOR || '#198754',\r\n      },\r\n      TYPEBOT: {\r\n        ENABLED: process.env?.TYPEBOT_ENABLED === 'true',\r\n        API_VERSION: process.env?.TYPEBOT_API_VERSION || 'old',\r\n        SEND_MEDIA_BASE64: process.env?.TYPEBOT_SEND_MEDIA_BASE64 === 'true',\r\n      },\r\n      CHATWOOT: {\r\n        ENABLED: process.env?.CHATWOOT_ENABLED === 'true',\r\n        MESSAGE_DELETE: process.env.CHATWOOT_MESSAGE_DELETE === 'true',\r\n        MESSAGE_READ: process.env.CHATWOOT_MESSAGE_READ === 'true',\r\n        BOT_CONTACT: !process.env.CHATWOOT_BOT_CONTACT || process.env.CHATWOOT_BOT_CONTACT === 'true',\r\n        IMPORT: {\r\n          DATABASE: {\r\n            CONNECTION: {\r\n              URI: process.env.CHATWOOT_IMPORT_DATABASE_CONNECTION_URI || '',\r\n            },\r\n          },\r\n          PLACEHOLDER_MEDIA_MESSAGE: process.env?.CHATWOOT_IMPORT_PLACEHOLDER_MEDIA_MESSAGE === 'true',\r\n        },\r\n      },\r\n      OPENAI: {\r\n        ENABLED: process.env?.OPENAI_ENABLED === 'true',\r\n        API_KEY_GLOBAL: process.env?.OPENAI_API_KEY_GLOBAL || null,\r\n      },\r\n      DIFY: {\r\n        ENABLED: process.env?.DIFY_ENABLED === 'true',\r\n      },\r\n      CACHE: {\r\n        REDIS: {\r\n          ENABLED: process.env?.CACHE_REDIS_ENABLED === 'true',\r\n          URI: process.env?.CACHE_REDIS_URI || '',\r\n          PREFIX_KEY: process.env?.CACHE_REDIS_PREFIX_KEY || 'evolution-cache',\r\n          TTL: Number.parseInt(process.env?.CACHE_REDIS_TTL) || 604800,\r\n          SAVE_INSTANCES: process.env?.CACHE_REDIS_SAVE_INSTANCES === 'true',\r\n        },\r\n        LOCAL: {\r\n          ENABLED: process.env?.CACHE_LOCAL_ENABLED === 'true',\r\n          TTL: Number.parseInt(process.env?.CACHE_REDIS_TTL) || 86400,\r\n        },\r\n      },\r\n      S3: {\r\n        ACCESS_KEY: process.env?.S3_ACCESS_KEY,\r\n        SECRET_KEY: process.env?.S3_SECRET_KEY,\r\n        ENDPOINT: process.env?.S3_ENDPOINT,\r\n        BUCKET_NAME: process.env?.S3_BUCKET,\r\n        ENABLE: process.env?.S3_ENABLED === 'true',\r\n        PORT: Number.parseInt(process.env?.S3_PORT || '9000'),\r\n        USE_SSL: process.env?.S3_USE_SSL === 'true',\r\n        REGION: process.env?.S3_REGION,\r\n      },\r\n      AUTHENTICATION: {\r\n        API_KEY: {\r\n          KEY: process.env.AUTHENTICATION_API_KEY || 'BQYHJGJHJ',\r\n        },\r\n        EXPOSE_IN_FETCH_INSTANCES: process.env?.AUTHENTICATION_EXPOSE_IN_FETCH_INSTANCES === 'true',\r\n      },\r\n    };\r\n  }\r\n}\r\n\r\nexport const configService = new ConfigService();\r\n","import axios from 'axios';\r\nimport fs from 'fs';\r\n\r\nconst packageJson = JSON.parse(fs.readFileSync('./package.json', 'utf8'));\r\n\r\nexport interface TelemetryData {\r\n  route: string;\r\n  apiVersion: string;\r\n  timestamp: Date;\r\n}\r\n\r\nexport const sendTelemetry = async (route: string): Promise<void> => {\r\n  const enabled = process.env.TELEMETRY_ENABLED === undefined || process.env.TELEMETRY_ENABLED === 'true';\r\n\r\n  if (!enabled) {\r\n    return;\r\n  }\r\n\r\n  if (route === '/') {\r\n    return;\r\n  }\r\n\r\n  const telemetry: TelemetryData = {\r\n    route,\r\n    apiVersion: `${packageJson.version}`,\r\n    timestamp: new Date(),\r\n  };\r\n\r\n  const url =\r\n    process.env.TELEMETRY_URL && process.env.TELEMETRY_URL !== ''\r\n      ? process.env.TELEMETRY_URL\r\n      : 'https://log.evolution-api.com/telemetry';\r\n\r\n  axios\r\n    .post(url, telemetry)\r\n    .then(() => {})\r\n    .catch(() => {});\r\n};\r\n"],"mappings":"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","names":["openai_service_exports","__export","OpenaiService","__toCommonJS","Integration","import_dayjs","import_fs","import_class_validator","import_dotenv","dotenv","ConfigService","key","configService","packageJson","fs","formatDateLog","timestamp","dayjs","Color","Level","Type","Background","Logger","context","configService","value","type","types","level","typeValue","Color","packageJson","formatDateLog","import_axios","import_fs","packageJson","fs","sendTelemetry","route","telemetry","url","axios","import_axios","import_baileys","import_form_data","import_openai","import_pino","OpenaiService","waMonitor","configService","prismaRepository","Logger","instance","openaiBot","remoteJid","content","messagesSystem","message","messagesAssistant","messagesUser","messageData","contentSplit","url","messages","Integration","completions","pushName","fromMe","threadId","sendTelemetry","runAssistant","response","session","settings","linkRegex","textBuffer","lastIndex","match","getMediaType","extension","imageExtensions","audioExtensions","videoExtensions","documentExtensions","fullMatch","exclMark","altText","mediaType","beforeText","splitMessages","timePerChar","minDelay","maxDelay","multipleMessages","index","delay","resolve","remainingText","data","creds","OpenAI","error","str","runId","functionUrl","getRun","toolCalls","toolCall","id","functionName","functionArgument","output","axios","now","sessionUpdatedAt","diff","msg","updateMediaMessage","audio","P","lang","formData","FormData"]}